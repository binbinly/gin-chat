"use strict";(self["webpackChunkvue_h5_template"]=self["webpackChunkvue_h5_template"]||[]).push([[405],{6405:function(t,e,i){i.r(e),i.d(e,{default:function(){return m}});var n=function(){var t=this,e=t._self._c;return e("div",[e("van-nav-bar",{attrs:{"left-text":"记忆心情","left-arrow":""},on:{"click-left":t.onClickLeft},scopedSlots:t._u([{key:"right",fn:function(){return[e("van-button",{attrs:{type:"primary",size:"small"},on:{click:t.submit}},[t._v("发表")])]},proxy:!0}])}),e("van-field",{attrs:{rows:"4",autosize:"",type:"textarea",maxlength:"500",placeholder:"这一刻的想法","show-word-limit":"",rules:[{required:!0}]},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}}),"image"===t.type?e("div",{staticClass:"bg-white p-1"},[e("van-uploader",{ref:"uploadImage",attrs:{name:"image","preview-full-image":"",multiple:"","after-read":t.afterRead,accept:"image/*","max-count":9},model:{value:t.imageList,callback:function(e){t.imageList=e},expression:"imageList"}})],1):t._e(),"video"===t.type&&t.video&&t.video?e("video",{staticStyle:{"max-width":"360px"},attrs:{src:t.video,controls:""}}):t._e(),"video"===t.type?e("van-uploader",{attrs:{name:"video",capture:"camera","prediv-image":!1,"after-read":t.afterRead,accept:".mp4"}},[t.video?e("div",{staticClass:"my-1 flex align-center justify-center bg-light",staticStyle:{height:"50px",width:"360px"},attrs:{"hover-class":"bg-hover-light"}},[e("span",{staticClass:"font-sm text-muted"},[t._v("点击切换视频")])]):e("div",{staticClass:"flex align-center justify-center bg-light px-1",staticStyle:{height:"175px",width:"360px"}},[e("span",{staticClass:"text-muted",staticStyle:{"font-size":"50px"}},[t._v("+")])])]):t._e(),e("van-cell",{attrs:{title:"所在位置",value:"位置","is-link":""},on:{click:t.draw}}),e("van-cell",{attrs:{title:"提醒谁看","is-link":"",center:"",to:"/contact_list?type=remind"},scopedSlots:t._u([{key:"default",fn:function(){return[e("div",{staticClass:"ml-1"},t._l(t.remindList,(function(i,n){return e("van-image",{staticStyle:{"margin-left":"5px"},attrs:{round:"",width:"25",height:"25",src:t._f("formatAvatar")(i.avatar)}})})),1)]},proxy:!0}])}),e("van-cell",{attrs:{title:"谁可以看",value:t.seeText,"is-link":"",center:"",to:"/contact_list?type=see"}})],1)},s=[],a=(i(58479),i(39146)),r=i(71568),o=i(18128),u=i(34160),c=i(2718),l={mixins:[r.Z],data(){return{content:"",imageList:[],type:"image",video:"",remindList:[],seeType:"all",seeList:[]}},activated(){const t=this.$route.query.type;t!=this.type&&this.init(),this.type=t},mounted(){o.Z.$on("sendResult",this.sendResult)},destroyed(){o.Z.$off("sendResult",this.sendResult)},computed:{seeText(){const t={all:"公开",none:"私密",only:"谁可以看",except:"不给谁看"};if("all"===this.seeType||"none"===this.seeType)return t[this.seeType];let e=this.seeList.map((t=>t.name)).join(",");return t[this.seeType]+":"+e}},methods:{init(){this.content="",this.imageList=[],this.video="",this.remindList=[],this.seeType="all",this.seeList=[]},sendResult(t){"remind"===t.type?this.remindList=t.data:"see"===t.type&&(this.seeType=t.data.k,this.seeList=t.data.v)},submit(){const t={text:1,image:2,video:3},e={all:1,none:2,only:3,except:4};if("text"===this.type&&""==this.content)return(0,a.Z)("内容不能为空");if("image"===this.type&&0==this.imageList.length)return(0,a.Z)("请选择图片");if("video"===this.type&&""==this.video)return(0,a.Z)("请上传短视频");let i=this.imageList.map((t=>t.url));(0,u.AU)({content:this.content,image:i.join(","),video:this.video,type:t[this.type],location:"",remind:this.remindList.map((t=>t.id)),see_type:e[this.seeType],see:this.seeList.map((t=>t.id))}).then((()=>{this.init(),a.Z.success("发布成功"),o.Z.$emit("refreshMoment"),this.$router.back()}))},afterRead(t,{name:e}){t instanceof Array?t.forEach((t=>{this.upload(t,e)})):this.upload(t,e)},upload(t,e){t.status="uploading",t.message="上传中...",(0,c.cT)(t.file).then((i=>{t.status="done","video"==e?this.video=i:t.url=i})).catch((()=>{t.status="failed",t.message="上传失败"}))}}},p=l,d=i(1001),h=(0,d.Z)(p,n,s,!1,null,null,null),m=h.exports},2718:function(t,e,i){i.d(e,{S0:function(){return u},YD:function(){return a},Zr:function(){return o},cT:function(){return c},qz:function(){return r},x4:function(){return s}});var n=i(7705);function s(t){return n.Z.post(n.Z.Login,t,!1)}function a(t){return n.Z.post(n.Z.Reg,t,!1)}function r(t){return n.Z.post(n.Z.SearchUser,t)}function o(){return n.Z.get(n.Z.EmoticonCat)}function u(t){return n.Z.get(n.Z.Emoticon,{cat:t},!0)}function c(t){return new Promise(((e,i)=>{n.Z.post(n.Z.Upload,{file:t},!0,!0).then((t=>t)).catch((t=>{i(t)}))}))}},34160:function(t,e,i){i.d(e,{AU:function(){return s},B8:function(){return r},BY:function(){return o},VU:function(){return a}});var n=i(7705);function s(t){return n.Z.post(n.Z.Moment.Create,t)}function a(t){return n.Z.post(n.Z.Moment.Like,t)}function r(t){return n.Z.post(n.Z.Moment.Comment,t)}function o(t,e){return t>0?n.Z.get(n.Z.Moment.List,{user_id:t,p:e}):n.Z.get(n.Z.Moment.Timeline,{p:e})}},71568:function(t,e,i){i(58479);var n=i(39146),s=i(76927);e["Z"]={created(){let t=(0,s.cF)("token");if(!t)return this.$router.push({path:"/login"})},methods:{onClickLeft(){this.$router.back()},push(t,e){this.$router.push({path:t,params:e})},draw(){(0,n.Z)("待开发")},backToast(t="非法参数"){this.toast(t),setTimeout((()=>{this.$router.back()}),500)},toast(t="非法参数"){(0,n.Z)({title:t,position:"bottom"})}}}}}]);
(self["webpackChunkvue_h5_template"]=self["webpackChunkvue_h5_template"]||[]).push([[143],{95602:function(t,e,n){"use strict";n.d(e,{D2:function(){return r},DA:function(){return s},rX:function(){return a},te:function(){return o}});var i=n(7705);function a(t){return i.Z.post(i.Z.Apply.Friend,t)}function s(t){return i.Z.get(i.Z.Apply.List,{p:t})}function o(){return i.Z.get(i.Z.Apply.Count)}function r(t){return i.Z.post(i.Z.Apply.Handle,t)}},40495:function(t,e,n){"use strict";n.d(e,{$T:function(){return a},hL:function(){return o},jz:function(){return s}});var i=n(7705);function a(t){return i.Z.post(i.Z.Chat.Send,t,!0,!0)}function s(t){return i.Z.post(i.Z.Chat.Recall,t)}function o(t){return i.Z.post(i.Z.Chat.Detail,t)}},14266:function(t,e,n){"use strict";n.d(e,{Eg:function(){return u},Hj:function(){return h},JH:function(){return r},Mx:function(){return l},Wk:function(){return c},lW:function(){return o},oJ:function(){return s},s_:function(){return a}});var i=n(7705);function a(){return i.Z.get(i.Z.Friend.List,null,!0)}function s(t){return i.Z.get(i.Z.Friend.Info,{id:t})}function o(t){return i.Z.post(i.Z.Friend.Destroy,{user_id:t})}function r(t){return i.Z.post(i.Z.Friend.Star,t)}function c(t){return i.Z.post(i.Z.Friend.Black,t)}function u(t){return i.Z.post(i.Z.Friend.RemarkTag,t)}function h(t){return i.Z.post(i.Z.Friend.MomentAuth,t)}function l(t){return i.Z.post(i.Z.Friend.Report,t)}},7705:function(t,e,n){"use strict";n.d(e,{Z:function(){return p}});n(58479);var i=n(39146),a=n(6154),s=n(77103),o=n(96333),r=n(29956),c=n(76927);const u=a.Z.create({baseURL:r.baseApi,timeout:5e3,headers:{"Content-Type":"application/json; charset=UTF-8"}});u.interceptors.request.use((t=>{if(t.hideloading||i.Z.loading({forbidClick:!0}),!0===t.auth){const e=(0,c.cF)("token");if(!e)return o.Z.replace({path:"/login"});t.headers["Token"]=e||""}return t}),(t=>Promise.reject(t))),u.interceptors.response.use((t=>{if(i.Z.clear(),200===t.status){const e=t.data;return 0===e.code?Promise.resolve(e.data):20111==e.code||20120==e.code?((0,i.Z)("令牌已过期，请重新登录"),s.Z.dispatch("logout"),Promise.reject(e.msg)):((0,i.Z)(e.msg),Promise.reject(e.msg))}return(0,i.Z)("网络开小差了"),Promise.reject(t.statusText)}),(t=>(i.Z.clear(),Promise.reject(t))));var h=u;const l={Login:"/login",Reg:"/reg",Logout:"/user/logout",SearchUser:"/user/search",EmoticonCat:"/emoticon/cat",Emoticon:"/emoticon/list",Upload:"/upload/file",Apply:{Friend:"/apply/friend",List:"/apply/list",Handle:"/apply/handle",Count:"/apply/count"},Friend:{List:"/friend/list",Info:"/friend/info",Black:"/friend/black",Star:"/friend/star",MomentAuth:"/friend/auth",RemarkTag:"/friend/remark",Report:"/user/report",Destroy:"/friend/destroy"},Chat:{Send:"/chat/send",Recall:"/chat/recall",Detail:"/chat/detail"},Group:{Create:"/group/create",List:"/group/list",Info:"/group/info",User:"/group/user",Edit:"/group/edit",Quit:"/group/quit",Nickname:"/group/nickname",KickOff:"/group/kickoff",Invite:"/group/invite",Join:"/group/join"},Tag:{List:"/user/tag",UserList:"/friend/tag_list"},User:{Edit:"/user/edit"},Collect:{Create:"/collect/create",List:"/collect/list",Destroy:"/collect/destroy"},Moment:{Create:"/moment/create",Like:"/moment/like",Comment:"/moment/comment",List:"/moment/list",Timeline:"/moment/timeline"},post(t,e,n=!0,i=!1){return h({url:t,method:"post",data:e,auth:n,hideloading:i})},get(t,e=null,n=!1){return h({url:t,params:e,hideloading:n,auth:!0})},upload(t,e){return h({url:t,method:"post",headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(t){},data:e,auth:!0,hideloading:!0})}};var p=l},29956:function(t){t.exports={title:"chat",baseApi:"https://gin-chat-production.up.railway.app/v1",socketUrl:"wss://gin-chat-production.up.railway.app/ws"}},57381:function(t,e){"use strict";const n=1,i=2,a=3,s=4,o=5,r=6,c=7;e["Z"]={PAGE_SIZE:20,CHAT_TYPE_USER:1,CHAT_TYPE_GROUP:2,TYPE_SYSTEM:n,TYPE_TEXT:i,TYPE_IMAGE:a,TYPE_VIDEO:s,TYPE_AUDIO:o,TYPE_EMOTICON:r,TYPE_CARD:c,TYPE_LIST:{system:n,text:i,image:a,video:s,audio:o,emoticon:r,card:c},TYPE_TRANS_LIST:{1:"system",2:"text",3:"image",4:"video",5:"audio",6:"emoticon",7:"card"}}},11811:function(t,e,n){"use strict";var i={};n.r(i),n.d(i,{formatAudio:function(){return dt},formatAvatar:function(){return pt},formatDate:function(){return rt},formatGroupAvatar:function(){return mt},formatTime:function(){return lt},hidePhone:function(){return ht},substr:function(){return ut}});n(28594),n(35666);var a=n(20144),s=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[e("router-view")],1)},o=[],r={name:"App"},c=r,u=n(1001),h=(0,u.Z)(c,s,o,!1,null,null,null),l=h.exports,p=n(96333),d=n(77103),m=(n(21768),n(18537)),g=(n(32465),n(63980)),f=(n(39610),n(2163)),Z=(n(47163),n(60819)),y=(n(70956),n(37364)),C=(n(22894),n(15473)),_=(n(73474),n(74755)),k=(n(23228),n(45644)),v=(n(11155),n(91391)),E=(n(72975),n(98655)),T=(n(46363),n(20495)),A=(n(13796),n(68286)),b=(n(20122),n(98244)),D=(n(70413),n(4321)),S=(n(895),n(53955)),O=(n(88694),n(41610)),L=(n(47601),n(44951)),P=(n(22871),n(5944)),R=(n(81376),n(57609)),I=(n(95622),n(96940)),U=(n(85684),n(10993)),M=(n(58479),n(39146)),x=(n(92042),n(78521)),F=(n(23307),n(81392)),w=(n(82500),n(49414)),B=(n(82522),n(10342)),Y=(n(77141),n(30960)),$=(n(93787),n(17221)),N=(n(47624),n(41956)),J=(n(25440),n(15032)),K=(n(35002),n(62476)),G=(n(84729),n(67763)),Q=(n(58775),n(59978)),H=(n(27902),n(50914)),V=(n(67489),n(57370)),j=(n(61586),n(41929)),q=(n(53611),n(27262)),X=(n(52355),n(29233)),W=(n(74289),n(64168)),z=(n(1533),n(2282)),tt=(n(31930),n(94907)),et=(n(25773),n(35791)),nt=(n(29678),n(24031)),it=(n(12479),n(85471)),at=(n(60615),n(51353)),st=(n(45379),n(97310));a.ZP.use(et.Z).use(nt.Z).use(it.Z).use(at.Z).use(st.Z),a.ZP.use(X.Z).use(W.Z).use(z.Z).use(tt.Z),a.ZP.use(H.Z).use(V.Z).use(j.Z).use(q.Z),a.ZP.use(J.Z).use(K.Z).use(G.Z).use(Q.Z),a.ZP.use(Y.Z).use($.Z).use(N.Z),a.ZP.use(M.Z).use(x.Z).use(F.Z).use(w.Z).use(B.Z),a.ZP.use(L.Z).use(P.Z).use(R.Z).use(I.Z).use(U.Z),a.ZP.use(A.Z).use(b.Z).use(D.Z).use(S.Z).use(O.Z),a.ZP.use(C.Z).use(_.Z).use(k.Z).use(v.Z).use(E.Z).use(T.Z),a.ZP.use(m.Z).use(g.Z).use(f.Z).use(Z.Z).use(y.Z);n(61335);var ot=n(557);function rt(t,e){if(void 0===t)return;const n=new Date(t);/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(n.getFullYear()+"").substr(4-RegExp.$1.length)));const i={"M+":n.getMonth()+1,"d+":n.getDate(),"h+":n.getHours(),"m+":n.getMinutes(),"s+":n.getSeconds()};for(const a in i)if(new RegExp(`(${a})`).test(e)){const t=i[a]+"";e=e.replace(RegExp.$1,1===RegExp.$1.length?t:ct(t))}return e}function ct(t){return("00"+t).substr(t.length)}function ut(t){return t.slice(0,3)}function ht(t){return t.replace(/(\d{3})\d{4}(\d{4})/,"$1****$2")}function lt(t){return ot.Z.gettime(t)}function pt(t){return t&&""!=t?t:n(81051)}function dt(t){return t&&""!=t?t:n(69722)}function mt(t){return t&&""!=t?t:n(38002)}Object.keys(i).forEach((t=>a.ZP.filter(t,i[t]))),a.ZP.prototype.$formatDate=a.ZP.filter("formatDate"),a.ZP.prototype.$hidePhone=a.ZP.filter("hidePhone");var gt={install(t,e={time:2e3}){t.directive("longpress",{bind:function(t,n,i){if("function"!==typeof n.value){const t=i.context.name;let e=`[longpress:] provided expression '${n.expression}' is not afunction, but has to be `;t&&(e+=`Found in component '${t}' `)}let a=null,s=t=>{"click"===t.type&&0!==t.button||null===a&&(a=setTimeout((()=>{r(t)}),e.time))},o=t=>{null!==a&&(clearTimeout(a),a=null)};const r=t=>{n.value(t)};t.addEventListener("mousedown",s),t.addEventListener("touchstart",s),t.addEventListener("click",o),t.addEventListener("mouseout",o),t.addEventListener("touchend",o),t.addEventListener("touchcancel",o)}})}};a.ZP.config.productionTip=!1,a.ZP.use(gt,{time:2e3}),new a.ZP({el:"#app",router:p.Z,store:d.Z,render:t=>t(l)})},96333:function(t,e,n){"use strict";n.d(e,{Z:function(){return u}});var i=n(20144),a=n(78345);const s=[{path:"/",component:()=>n.e(700).then(n.bind(n,30700)),redirect:"/home",meta:{title:"首页",keepAlive:!1},children:[{path:"/home",name:"Home",component:()=>n.e(780).then(n.bind(n,4780)),meta:{title:"首页",keepAlive:!1,tabbar:!0,badge:""}},{path:"/contact",name:"Contact",component:()=>n.e(150).then(n.bind(n,99150)),meta:{title:"通讯录",keepAlive:!1,tabbar:!0,badge:""}},{path:"/find",name:"Find",component:()=>n.e(10).then(n.bind(n,58010)),meta:{title:"发现",keepAlive:!1,tabbar:!0,badge:""}},{path:"/my",name:"My",component:()=>n.e(468).then(n.bind(n,6468)),meta:{title:"我的",keepAlive:!1,tabbar:!0,badge:""}},{path:"/login",name:"Login",component:()=>n.e(959).then(n.bind(n,81959)),meta:{title:"登录",keepAlive:!1}},{path:"/apply_list",name:"ApplyList",component:()=>n.e(190).then(n.bind(n,86190)),meta:{title:"申请好友列表",keepAlive:!0}},{path:"/add_friend",name:"AddFriend",component:()=>n.e(480).then(n.bind(n,86480)),meta:{title:"添加好友",keepAlive:!0}},{path:"/search",name:"Search",component:()=>n.e(383).then(n.bind(n,38383)),meta:{title:"搜索",keepAlive:!1}},{path:"/user_base",name:"UserBase",component:()=>n.e(664).then(n.bind(n,92664)),meta:{title:"用户信息",keepAlive:!0}},{path:"/user_remark_tag",name:"UserRemarkTag",component:()=>n.e(186).then(n.bind(n,31186)),meta:{title:"设置备注和标签",keepAlive:!0}},{path:"/chat_list",name:"ChatList",component:()=>n.e(555).then(n.bind(n,4555)),meta:{title:"好友列表",keepAlive:!0}},{path:"/user_moments_auth",name:"UserMomentsAuth",component:()=>n.e(179).then(n.bind(n,15179)),meta:{title:"设置朋友圈权限",keepAlive:!0}},{path:"/user_report",name:"UserReport",component:()=>n.e(630).then(n.bind(n,75630)),meta:{title:"投诉",keepAlive:!0}},{path:"/tag_list",name:"TagList",component:()=>n.e(879).then(n.bind(n,18879)),meta:{title:"标签",keepAlive:!0}},{path:"/tag_read",name:"TagRead",component:()=>n.e(910).then(n.bind(n,11910)),meta:{title:"标签用户",keepAlive:!0}},{path:"/contact_list",name:"ContactList",component:()=>n.e(877).then(n.bind(n,22877)),meta:{title:"好友列表",keepAlive:!0}},{path:"/group_list",name:"GroupList",component:()=>n.e(927).then(n.bind(n,16927)),meta:{title:"群组列表",keepAlive:!0}},{path:"/userinfo",name:"Userinfo",component:()=>Promise.all([n.e(874),n.e(240)]).then(n.bind(n,71240)),meta:{title:"用户资料",keepAlive:!0}},{path:"/fava",name:"Fava",component:()=>n.e(183).then(n.bind(n,64183)),meta:{title:"收藏",keepAlive:!0}},{path:"/setting",name:"Setting",component:()=>n.e(232).then(n.bind(n,61232)),meta:{title:"设置",keepAlive:!1}},{path:"/chat",name:"Chat",component:()=>n.e(292).then(n.bind(n,21292)),meta:{title:"聊天窗口",keepAlive:!0}},{path:"/chat_set",name:"ChatSet",component:()=>Promise.all([n.e(874),n.e(916)]).then(n.bind(n,10236)),meta:{title:"聊天信息",keepAlive:!0}},{path:"/chat_history",name:"ChatHistory",component:()=>n.e(942).then(n.bind(n,24942)),meta:{title:"聊天记录",keepAlive:!0}},{path:"/group_user",name:"GroupUser",component:()=>n.e(914).then(n.bind(n,13914)),meta:{title:"群聊用户",keepAlive:!0}},{path:"/moments",name:"Moments",component:()=>n.e(803).then(n.bind(n,43803)),meta:{title:"朋友圈",keepAlive:!0}},{path:"/add_moment",name:"AddMoment",component:()=>n.e(667).then(n.bind(n,97667)),meta:{title:"心情发布",keepAlive:!0}},{path:"/emoticon_cat",name:"EmoticonCat",component:()=>n.e(142).then(n.bind(n,57142)),meta:{title:"表情包",keepAlive:!0}},{path:"/emoticon",name:"Emoticon",component:()=>n.e(584).then(n.bind(n,72584)),meta:{title:"表情",keepAlive:!0}}]}],o=a.ZP.prototype.push;a.ZP.prototype.push=function(t,e,n){return e||n?o.call(this,t,e,n):o.call(this,t).catch((t=>t))},i.ZP.use(a.ZP);const r=()=>new a.ZP({scrollBehavior:()=>({y:0}),routes:s}),c=r();var u=c},77103:function(t,e,n){"use strict";n.d(e,{Z:function(){return A}});var i=n(20144),a=n(20629);const s={name:t=>t.user.nickname||t.user.username};var o=s,r={state:{events:[],RECORD:null,RecordTime:0,RECORDTIMER:null,sendVoice:null},mutations:{initRECORD(t){t.RECORD=uni.getRecorderManager(),t.RECORD.onStart((()=>{t.RecordTime=0,t.RECORDTIMER=setInterval((()=>{t.RecordTime++}),1e3)})),t.RECORD.onStop((e=>{t.RECORDTIMER&&(clearInterval(t.RECORDTIMER),t.RECORDTIMER=null),"function"===typeof t.sendVoice&&t.sendVoice(e.tempFilePath)}))},regSendVoiceEvent(t,e){t.sendVoice=e},regEvent(t,e){t.events.push(e)},doEvent(t,e){t.events.forEach((t=>{t(e)}))},removeEvent(t,e){let n=t.events.findIndex((t=>t===e));-1!==n&&t.events.splice(n,1)}},actions:{audioOn({commit:t},e){t("regEvent",e)},audioEmit({commit:t},e){t("doEvent",e)},audioOff({commit:t},e){t("removeEvent",e)}}},c=n(76927),u=n(95602),h=n(14266),l=n(29956),p=n.n(l),d=n(96333),m=(n(88694),n(41610)),g=(n(58479),n(39146)),f=n(40495),Z=n(18128),y=n(57381);class C{constructor(t){this.url=t.url,this.isOnline=!1,this.socket=null,this.reconnectCount=0,this.isOpenReconnect=!0,this.heart=null;let e=(0,c.cF)("user");e?(e=JSON.parse(e),this.user={...e}):this.user={},this.TO=!1,this.token=(0,c.cF)("token"),this.token&&this.connectSocket()}reconnect(){if(!this.isOnline){if(this.reconnectCount>=3)return this.reconnectConfirm();this.reconnectCount+=1,this.connectSocket()}}connectSocket(){this.socket=new WebSocket(this.url+"?token="+this.token),this.socket&&(this.socket.onopen=()=>this.onOpen(),this.socket.onmessage=t=>this.onMessage(t),this.socket.onclose=t=>this.onClose(t),this.socket.onerror=t=>this.onError(t))}heartStart(){this.heart=setInterval((()=>{this.socket.send("ping")}),45e3)}onOpen(){this.isOnline=!0,this.isOpenReconnect=!0,this.heartStart(),this.socket.send('{"event":"history"}')}clearUser(){this.isOnline=!1,this.socket=null,clearInterval(this.heart),this.heart=null}onClose(t){this.clearUser(),this.isOpenReconnect&&this.reconnect()}onError(t){this.clearUser()}onMessage(t){if("pong"==t.data)return;const e=JSON.parse(t.data);switch(e.event){case"fail":g.Z.fail(e.data);break;case"close":g.Z.fail(e.data),this.close(),A.dispatch("logout");break;case"recall":this.handleOnRecall(e.data);break;case"notify":e.data.type&&"apply"==e.data.type&&A.dispatch("getApply");break;case"moment":this.handleMoment(e.data);break;case"chat":this.handleOnMessage(e.data);break;default:}}getNotice(){let t=(0,c.cF)("moment_"+this.user.id);return t?JSON.parse(t):{avatar:"",user_id:0,num:0}}async handleMoment(t){let e=this.getNotice();switch(t.type){case"new":t.user_id!==this.user.id&&(e.avatar=t.avatar,e.user_id=t.user_id,e.num+=1,Z.Z.$emit("tabBarBadge",{index:2,text:""}));break;default:t.user_id!==this.user.id&&(e.avatar=t.avatar,e.user_id=t.user_id,e.num+=1),e.num>0?Z.Z.$emit("tabBarBadge",{index:2,text:e.num>99?"99+":e.num.toString()}):Z.Z.$emit("tabBarBadge",{index:2,text:""});break}Z.Z.$emit("momentNotice",e),(0,c.po)("moment_"+this.user.id,JSON.stringify(e))}async readMoments(){let t={avatar:"",user_id:0,num:0};(0,c.po)("moment_"+this.user.id,JSON.stringify(t)),Z.Z.$emit("tabBarBadge",{index:2,text:""}),Z.Z.$emit("momentNotice",t)}async handleOnRecall(t){Z.Z.$emit("onRecall",t);let e=t.chat_type===y.Z.CHAT_TYPE_USER?t.from_id:t.to_id;this.deleteChatDetailItem(t.id,t.chat_type,e),this.updateChatItem({id:e,chat_type:t.chat_type},(t=>(t.content="对方撤回了一条消息",t.t=(new Date).getTime(),t)))}async handleOnMessage(t){t.chat_type===y.Z.CHAT_TYPE_USER&&(t.to={id:this.user.id});let{data:e}=this.addChatDetail(t,!1);this.updateChatList(e,!1),Z.Z.$emit("onMessage",e)}close(){this.socket&&this.socket.close(),this.isOpenReconnect=!1}createChatObject(t){this.TO=t}destroyChatObject(){this.TO=!1}reconnectConfirm(){m.Z.confirm({message:"你已经断线，是否重新连接？",confirmButtonText:"重新连接"}).then((()=>{this.reconnectCount=0,this.connectSocket()}))}checkOnline(){return!!this.isOnline||(this.reconnectConfirm(),!1)}formatSendData(t){return{id:"",from:this.user,to:this.TO||t.to,chat_type:t.chat_type||this.TO.chat_type,type:y.Z.TYPE_LIST[t.type],content:t.content,options:t.options?t.options:{},t:(new Date).getTime(),self:!0,status:t.status?t.status:"pending"}}recall(t){return new Promise(((e,n)=>{(0,f.jz)({to_id:this.TO.id,chat_type:t.chat_type,id:t.id}).then((n=>{this.deleteChatDetailItem(t.id,t.chat_type,this.TO.id),e(n),this.updateChatItem({id:t.TO.id,chat_type:t.chat_type},(t=>(t.content="你撤回了一条消息",t.t=(new Date).getTime(),t)))})).catch((t=>{n(t)}))}))}send(t,e=!1){return new Promise((async(e,n)=>{if(!this.checkOnline())return n("未上线");const{k:i}=this.addChatDetail(t);(0,f.$T)({to_id:this.TO.id||t.to.id,chat_type:t.chat_type||this.TO.chat_type,type:t.type,content:t.content,options:t.options}).then((n=>{t.id=n.id,t.status="success",this.updateChatDetail(t,i),e(n)})).catch((e=>{t.status="fail",this.updateChatDetail(t,i),n(e)})),this.updateChatList(t)}))}addChatDetail(t,e=!0){let n=t.chat_type===y.Z.CHAT_TYPE_USER?e?t.to.id:t.from.id:t.to.id,i=this.getChatDetail(t.chat_type,n);return t.k="k"+i.length,i.push(t),this.setChatDetail(t.chat_type,n,i),{data:t,k:t.k}}async deleteChatDetailItem(t,e,n){let i=this.getChatDetail(e,n),a=i.findIndex((e=>e.id===t));-1!==a&&(i.splice(a,1),this.setChatDetail(e,n,i))}async updateChatDetail(t,e,n=!0){let i=t.chat_type===y.Z.CHAT_TYPE_USER?n?t.to.id:t.from.id:t.to.id,a=this.getChatDetail(t.chat_type,i),s=a.findIndex((t=>t.k===e));-1!==s&&(a[s]=t,this.setChatDetail(t.chat_type,i,a))}formatChatItemData(t,e){let n=t.content;switch(t.type){case y.Z.TYPE_EMOTICON:n="[表情]";break;case y.Z.TYPE_IMAGE:n="[图片]";break;case y.Z.TYPE_AUDIO:n="[语音]";break;case y.Z.TYPE_VIDEO:n="[视频]";break;case y.Z.TYPE_CARD:n="[名片]";break}return e?n:`${t.from.name}: ${n}`}updateChatList(t,e=!0){let n=this.getChatList(),i=!1,a={};t.chat_type===y.Z.CHAT_TYPE_USER?(i=!!this.TO&&(e?this.TO.id===t.to.id:this.TO.id===t.from.id),a=e?this.TO:t.from):(i=this.TO&&this.TO.id===t.to.id,a=t.to);let s=n.findIndex((e=>e.chat_type===t.chat_type&&e.id===a.id));const o=this.formatChatItemData(t,e);let r=e||i?0:1;if(-1===s){let e={id:a.id,name:a.name,avatar:a.avatar,chat_type:t.chat_type,t:t.t||(new Date).getTime(),content:o,type:t.type,unread:r,is_top:!1,show_name:!1,no_remind:!1,is_remind:!1};t.chat_type===y.Z.CHAT_TYPE_GROUP&&(e.show_name=!0),n.unshift(e)}else{let e=n[s];e.t=t.t||(new Date).getTime(),e.name=a.name,e.avatar=a.avatar,e.content=o,e.type=t.type,e.unread+=r,n=this.listToFirst(n,s)}return this.setChatList(n),this.updateBadge(n),Z.Z.$emit("onUpdateChatList",n),n}async updateBadge(t=!1){t=t||this.getChatList();let e=0;t.forEach((t=>{e+=t.unread})),e>0?Z.Z.$emit("tabBarBadge",{index:0,text:e<=99?e.toString():"99+"}):Z.Z.$emit("tabBarBadge",{index:0,text:""}),Z.Z.$emit("totalunread",e)}async updateChatItemKey(t,e,n,i){let a=this.getChatList(),s=a.findIndex((n=>n.id===t&&n.chat_type===e));-1!==s&&(a[s][n]=i,this.setChatList(a))}async updateChatItem(t,e){let n=this.getChatList(),i=n.findIndex((e=>e.id===t.id&&e.chat_type===t.chat_type));-1!==i&&(n[i]="function"===typeof e?e(n[i]):e,this.setChatList(n),Z.Z.$emit("onUpdateChatList",n))}async readChatItem(t,e){let n=this.getChatList(),i=n.findIndex((n=>n.id===t&&n.chat_type===e));-1!==i&&(n[i].unread=0,this.setChatList(n),this.updateBadge(),Z.Z.$emit("onUpdateChatList",n))}async removeChatItem(t,e){let n=this.getChatList(),i=n.findIndex((n=>n.id===t&&n.chat_type===e));-1!==i&&(n.splice(i,1),this.setChatList(n),this.updateBadge(),Z.Z.$emit("onUpdateChatList",n))}async clearChatDetail(t,e){this.removeChatDetail(e,t);let n=this.getChatList(),i=n.findIndex((n=>n.id===t&&n.chat_type===e));-1!==i&&(n[i].content="",this.setChatList(n),Z.Z.$emit("onUpdateChatList",n))}chatKey(t,e){return`chatDetail_${this.user.id}_${t}_${e}`}getChatDetail(t,e){return t=t||this.TO.chat_type,e=e||this.TO.id,this.getStorage(this.chatKey(t,e))}setChatDetail(t,e,n){return this.setStorage(this.chatKey(t,e),n)}removeChatDetail(t,e){return(0,c.Li)(this.chatKey(t,e))}getChatList(){const t=`chatList_${this.user.id}`;return this.getStorage(t)}setChatList(t){const e=`chatList_${this.user.id}`;return this.setStorage(e,t)}getChatListItem(t,e){let n=this.getChatList(),i=n.findIndex((n=>n.id==t&&n.chat_type==e));return-1!==i&&n[i]}getStorage(t){let e=(0,c.cF)(t);return e?JSON.parse(e):[]}setStorage(t,e){return(0,c.po)(t,JSON.stringify(e))}listToFirst(t,e){return 0!=e&&t.unshift(t.splice(e,1)[0]),t}}var _=C,k=n(21620),v=n.n(k),E={state:{user:!1,token:!1,apply:{list:[],count:0},friends:[],emoCat:[],chat:null,chatList:[],totalunread:0,notice:{avatar:"",user_id:0,num:0}},mutations:{updateUser(t,{k:e,v:n}){t.user&&(t.user[e]=n,(0,c.po)("user",JSON.stringify(t.user)))},addEmo(t,e){t.emoCat.push(e),(0,c.po)("emoticon_cat",JSON.stringify(t.emoCat))},delEmo(t,e){t.emoCat.splice(t.emoCat.findIndex((t=>t===e)),1),(0,c.po)("emoticon_cat",JSON.stringify(t.emoCat))}},actions:{login({state:t,dispatch:e},n){n.user.name=n.user.nickname||n.user.username,t.user=n.user,t.token=n.token,(0,c.po)("token",n.token),(0,c.po)("user",JSON.stringify(n.user)),(0,c.po)("user_id",n.user.id),e("getApply"),t.chat=new _({url:p().socketUrl}),e("getChatList"),e("updateBadge"),e("getNotice")},logout({state:t}){t.user=!1,(0,c.Li)("token"),(0,c.Li)("user"),(0,c.Li)("user_id"),t.chat&&(t.chat.close(),t.chat=null),d.Z.replace({path:"/login"}),Z.Z.$off("onUpdateChatList"),Z.Z.$off("momentNotice"),Z.Z.$off("totalunread")},initLogin({state:t,dispatch:e}){const n=(0,c.cF)("user");n&&(t.user=JSON.parse(n),t.chat=new _({url:p().socketUrl}),t.emoCat=(0,c.cF)("emoticon_cat")?JSON.parse((0,c.cF)("emoticon_cat")):[],e("getChatList"),e("getApply"),e("updateBadge"),e("getNotice"))},getApply({state:t,dispatch:e},n=1){(0,u.te)().then((n=>{t.apply.count=n,e("updateMailBadge")}))},updateMailBadge({state:t}){let e="";t.apply.count>99?e="99+":t.apply.count>0&&(e=t.apply.count+""),Z.Z.$emit("tabBarBadge",{index:1,text:e})},contactList({state:t}){(0,h.s_)().then((e=>{if(e.length>0){const n=new(v())(e,"name");t.friends=n.newList}}))},getChatList({state:t}){t.chatList=t.chat.getChatList(),Z.Z.$on("onUpdateChatList",(e=>{t.chatList=e}))},getNotice({state:t}){t.notice=t.chat.getNotice(),t.notice.num>0?Z.Z.$emit("tabBarBadge",{index:2,text:t.notice.num>99?"99+":t.notice.num.toString()}):Z.Z.$emit("tabBarBadge",{index:2,text:""}),Z.Z.$on("momentNotice",(e=>{t.notice=e}))},updateBadge({state:t}){Z.Z.$on("totalunread",(e=>{t.totalunread=e})),t.chat.updateBadge()},reconnect({state:t}){t.user&&t.chat&&t.chat.reconnect()}}};i.ZP.use(a.ZP);const T=new a.ZP.Store({modules:{audio:r,user:E},getters:o});var A=T},18128:function(t,e,n){"use strict";var i=n(20144);e["Z"]=new i.ZP},76927:function(t,e,n){"use strict";n.d(e,{Li:function(){return s},cF:function(){return i},po:function(){return a}});n(82801),n(37380),n(1118);function i(t){return localStorage.getItem(t)}function a(t,e){return localStorage.setItem(t,e)}function s(t){return localStorage.removeItem(t)}},557:function(t,e){"use strict";e["Z"]={getHoroscope(t){let e=["摩羯","水瓶","双鱼","白羊","金牛","双子","巨蟹","狮子","处女","天秤","天蝎","射手","摩羯"];t=new Date(t);let n=t.getMonth()+1,i=t.getDate(),a=n-(i-14<"865778999988".charAt(n));return e[a]+"座"},sumAge(t){let e=new Date(t.replace(/-/g,"/")),n=new Date,i=n.getTime()-e.getTime(),a=Math.floor(i/864e5),s=i%864e5,o=Math.floor(s/36e5),r=s%36e5,c=(Math.floor(r/6e4),r%6e4);Math.round(c/1e3);return a+"天 "+o+"小时 "},getChatTime(t,e){if(t=t.toString().length<13?1e3*t:t,e=e.toString().length<13?1e3*e:e,(parseInt(t)-parseInt(e))/1e3>300)return this.gettime(t)},gettime(t){t=t.toString().length<13?1e3*t:t;let e=(new Date).getTime(),n=(e-parseInt(t))/1e3;return n<43200?this.dateFormat(new Date(t),"{A} {t}:{ii}"):n<518400?this.dateFormat(new Date(t),"{Mon}月{DD}日 {A} {t}:{ii}"):this.dateFormat(new Date(t),"{Y}-{MM}-{DD} {A} {t}:{ii}")},parseNumber(t){return t<10?"0"+t:t},dateFormat(t,e){let n={},i=/\{([^}]+)\}/,a=["1","2","3","4","5","6","7","8","9","10","11","12"];n["Y"]=t.getFullYear(),n["M"]=t.getMonth()+1,n["MM"]=this.parseNumber(n["M"]),n["Mon"]=a[n["M"]-1],n["D"]=t.getDate(),n["DD"]=this.parseNumber(n["D"]),n["h"]=t.getHours(),n["hh"]=this.parseNumber(n["h"]),n["t"]=n["h"]>12?n["h"]-12:n["h"],n["tt"]=this.parseNumber(n["t"]),n["A"]=n["h"]>12?"下午":"上午",n["i"]=t.getMinutes(),n["ii"]=this.parseNumber(n["i"]),n["s"]=t.getSeconds(),n["ss"]=this.parseNumber(n["s"]);while(i.test(e))e=e.replace(i,n[RegExp.$1]);return e},getAgeByBirthday(t){let e=new Date(t.replace(/-/g,"/")),n=new Date;return n.getFullYear()-e.getFullYear()-(n.getMonth()<e.getMonth()||n.getMonth()==e.getMonth()&&n.getDate()<e.getDate()?1:0)}}},69722:function(t){"use strict";t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAC/klEQVR4Xu2dMXIaMRSGV0DlVNzAbUw6JqkB6SDOSZzchIOsGGp76IJTxjegSioGZYg9YxyjhfV7eB87Hy3o8fb7+LVaLdiu4GGKgDPVDc0UCDH2IUAIQowRMNYOCUGIMQLG2iEhCDFGwFg7JAQhxggYa4eEIMQYAWPtkBCEGCNgrB0SghA5geFweNHv979UVVqtVreLxeKP/N3et8JZJmQ8Hg+63e6PKlQppUGM8f59ccrfDSFyhqoVEKKKU14MIXKGqhUQoopTXgwhcoaqFRCiilNeDCFyhqoVEKKKU14MIXKGqhUQoopTXgwhcoaqFRoR4r2fOucuc0ey2Wyms9lsmns+hPCxKIpD+1RXZVn+zNWYTCbXnU7nOvd8SulXjPGrKu0jijUiJISwhbmFmnt8L8vyW+5Jjc3FEMK2/k2FkPsY4+AIhqovQUgGZ0oJITtsSIhq7g4UY8rKA2LKYsoqChJCQl4RYJW1g4SEkBASUrXQIiEkpL0JGY1Gl71eL7sPlVL6HWO8q0qI937pnLt669aJxl7WESf1ZYzx04Hj+Oyc+5B7zXq9fpjP5w91rvFqX4cccSAHtxzaMmVJj2OfKIQILgwR8gTPym4vQhDyOs+cQ56ZkBASQkJOeYHLKuvlfpr4Fi5TFlMWUxZT1iOBs7inzpTFlMWUxZTFlFVnc/jfFxQaXy6yl2Vs/Y6QHSHcoHqG4b1v/gZVvQlu/6uly0UrCdFg8X+N2jeoNJpASJ4iQgR3DDU+nCTkiYDGahEhxq7UEYKQU3wG+PZ7FVVO6pzUSQgJ2UOAVdbL/TB+Fp2JSSPnEP5wgLErdenaTWMvS9rDqcY3khDpwSBESlB5PEKUgUrLIURKUHk8QpSBSsshREpQeTxClIFKyyFESlB5PEKUgUrLIURKUHk8QpSBSsshREpQeTz/8kgZKOVattvbZqFnuduLkDYTMHZsJAQhxggYa4eEIMQYAWPtkBCEGCNgrB0SghBjBIy1Q0IQYoyAsXZICEKMETDWzl8KGiywXyX0mgAAAABJRU5ErkJggg=="},38002:function(t,e,n){"use strict";t.exports=n.p+"static/img/group.c8486aa7.jpg"},81051:function(t,e,n){"use strict";t.exports=n.p+"static/img/userpic.7e92639c.png"}},function(t){var e=function(e){return t(t.s=e)};t.O(0,[922,114],(function(){return e(11811)}));t.O()}]);
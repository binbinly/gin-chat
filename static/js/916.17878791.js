"use strict";(self["webpackChunkvue_h5_template"]=self["webpackChunkvue_h5_template"]||[]).push([[916],{10236:function(t,e,i){i.r(e),i.d(e,{default:function(){return k}});var n=function(){var t=this,e=t._self._c;return e("div",[e("van-nav-bar",{attrs:{"left-text":"聊天信息",fixed:"",placeholder:"","left-arrow":""},on:{"click-left":t.onClickLeft}}),e("div",{staticClass:"flex flex-wrap py-1 bg-white"},[t.isUser?e("div",{staticClass:"flex flex-column align-center justify-center mb-1 ml-1"},[e("van-image",{attrs:{src:t._f("formatAvatar")(t.detail.avatar),round:"",width:"50",height:"50"}}),e("span",{staticClass:"text-muted",staticStyle:{"margin-top":"5px"}},[t._v(t._s(t.detail.name))])],1):t._l(t.list,(function(i,n){return e("div",{key:n,staticClass:"flex flex-column align-center justify-center mb-1 ml-1"},[e("van-image",{attrs:{src:t._f("formatAvatar")(i.avatar),round:"",width:"50",height:"50"}}),e("span",{staticClass:"text-muted",staticStyle:{"margin-top":"5px"}},[t._v(t._s(i.name))])],1)})),e("div",{staticClass:"mb-1 ml-1"},[e("div",{staticClass:"border",on:{click:t.addUser}},[e("van-icon",{staticClass:"text-light-muted p-1",attrs:{name:"plus",size:"30"}})],1)]),t.isGroup?e("div",{staticClass:"mb-1 ml-1"},[e("div",{staticClass:"border",on:{click:t.deleteUser}},[e("van-icon",{staticClass:"text-light-muted p-1",attrs:{name:"minus",size:"30"}})],1)]):t._e()],2),t.isGroup?e("div",[e("van-divider"),e("van-cell",{attrs:{title:"群聊名称","is-link":""},on:{click:function(e){t.show=!0,t.editType="name"}},scopedSlots:t._u([{key:"default",fn:function(){return[e("span",{staticClass:"text-inline"},[t._v(t._s(t.detail.name))])]},proxy:!0}],null,!1,2163982983)}),e("van-cell",{attrs:{title:"群二维码","is-link":""},on:{click:t.creatQrCode},scopedSlots:t._u([{key:"default",fn:function(){return[e("span",{staticClass:"iconfont"},[t._v("")])]},proxy:!0}],null,!1,3399527380)}),e("van-cell",{attrs:{title:"群公告",value:t.detail.remark,"is-link":""},on:{click:function(e){t.show=!0,t.editType="remark"}}})],1):t._e(),e("van-divider"),e("van-cell",{attrs:{title:"查找聊天记录","is-link":""},on:{click:t.openHistory}}),e("van-divider"),e("van-cell",{attrs:{center:"",title:"消息免打扰"},scopedSlots:t._u([{key:"right-icon",fn:function(){return[e("van-switch",{attrs:{size:"24","active-color":"#08c060"},on:{change:function(e){return t.updateChatItem(t.setting.no_remind,"no_remind")}},model:{value:t.setting.no_remind,callback:function(e){t.$set(t.setting,"no_remind",e)},expression:"setting.no_remind"}})]},proxy:!0}])}),e("van-cell",{attrs:{center:"",title:"置顶聊天"},scopedSlots:t._u([{key:"right-icon",fn:function(){return[e("van-switch",{attrs:{size:"24","active-color":"#08c060"},on:{change:function(e){return t.updateChatItem(t.setting.is_top,"is_top")}},model:{value:t.setting.is_top,callback:function(e){t.$set(t.setting,"is_top",e)},expression:"setting.is_top"}})]},proxy:!0}])}),e("van-cell",{attrs:{center:"",title:"强提醒"},scopedSlots:t._u([{key:"right-icon",fn:function(){return[e("van-switch",{attrs:{size:"24","active-color":"#08c060"},on:{change:function(e){return t.updateChatItem(t.setting.is_remind,"is_remind")}},model:{value:t.setting.is_remind,callback:function(e){t.$set(t.setting,"is_remind",e)},expression:"setting.is_remind"}})]},proxy:!0}])}),t.isGroup?e("div",[e("van-divider"),e("van-cell",{attrs:{title:"我在本群的昵称","is-link":"",value:t.nickname},on:{click:function(e){t.show=!0,t.editType="nickname"}}}),e("van-cell",{attrs:{center:"",title:"显示群成员昵称"},scopedSlots:t._u([{key:"right-icon",fn:function(){return[e("van-switch",{attrs:{size:"24","active-color":"#08c060"},on:{change:function(e){return t.updateChatItem(t.setting.show_name,"show_name")}},model:{value:t.setting.show_name,callback:function(e){t.$set(t.setting,"show_name",e)},expression:"setting.show_name"}})]},proxy:!0}],null,!1,2056579725)})],1):t._e(),e("van-divider"),e("van-cell",{attrs:{title:"清空聊天记录","is-link":""},on:{click:t.clear}}),e("van-divider"),e("van-cell",{attrs:{title:"投诉","is-link":""},on:{click:t.openReport}}),e("van-divider"),t.isGroup?e("van-button",{attrs:{block:"",icon:"delete",type:"danger"},on:{click:t.quit}},[t._v("删除并退出")]):t._e(),e("div",{staticStyle:{height:"50px"}}),e("van-overlay",{attrs:{show:t.show},on:{click:function(e){t.show=!1}}},[e("div",{staticClass:"wrapper-bottom"},[e("div",{staticClass:"bg-white rounded w-100",on:{click:function(t){t.stopPropagation()}}},[e("van-form",{on:{submit:t.onSubmit}},["name"==t.editType?e("van-field",{attrs:{label:"群聊名称",clearable:"",placeholder:"请输入群聊名称",rules:[{required:!0}]},model:{value:t.detail.name,callback:function(e){t.$set(t.detail,"name",e)},expression:"detail.name"}}):"nickname"==t.editType?e("van-field",{attrs:{label:"群昵称",clearable:"",placeholder:"请输入群昵称",rules:[{required:!0}]},model:{value:t.nickname,callback:function(e){t.nickname=e},expression:"nickname"}}):"remark"==t.editType?e("van-field",{attrs:{type:"textarea",clearable:"",rows:"2",maxlength:"240",label:"群公告",placeholder:"请输入群公告",rules:[{required:!0}]},model:{value:t.detail.remark,callback:function(e){t.$set(t.detail,"remark",e)},expression:"detail.remark"}}):t._e(),e("div",{staticStyle:{margin:"16px"}},[e("van-button",{attrs:{round:"",block:"",type:"primary","native-type":"submit"}},[t._v("提交")])],1)],1)],1)])]),t.isGroup?e("van-overlay",{attrs:{show:t.showCode},on:{click:function(e){t.showCode=!1}}},[e("div",{staticClass:"wrapper"},[e("div",{staticClass:"bg-white rounded p-4"},[e("div",{staticClass:"flex align-center mb-2 justify-center"},[e("van-image",{staticClass:"avatar",attrs:{src:t._f("formatAvatar")(t.detail.avatar)}}),e("div",{staticClass:"pl-1 flex flex-column"},[e("span",[t._v(t._s(t.detail.name))])])],1),e("div",{staticClass:"flex flex-column align-center justify-center"},[e("div",{ref:"groupUrl",staticClass:"qrcode mb-2"}),e("span",{staticClass:"text-light-muted"},[t._v("扫一扫上边二维码图案，加我的仿微信")])])])])]):t._e()],1)},s=[],a=(i(58479),i(39146)),r=(i(88694),i(41610)),o=i(20629),c=i(71568),l=i(83874),u=i.n(l),d=i(79591),h=i(18128),p=i(57381),m={mixins:[c.Z],data(){return{show:!1,showCode:!1,editType:"",qrcode:!1,list:[],nickname:"",id:0,chat_type:1,detail:{id:0,avatar:"",name:"",user_id:0,remark:"",invite_confirm:0},setting:{is_top:!1,show_name:!1,no_remind:!1,is_remind:!1}}},computed:{...(0,o.rn)({chat:t=>t.user.chat,user:t=>t.user.user}),isUser(){return this.chat_type===p.Z.CHAT_TYPE_USER},isGroup(){return this.chat_type===p.Z.CHAT_TYPE_GROUP}},activated(){const{id:t,chat_type:e}=this.$route.query;if(!t||!e)return this.backToast();this.id==t&&this.chat_type==e||(this.chat_type=parseInt(e),this.id=parseInt(t),this.initData())},mounted(){h.Z.$on("refreshGroupInfo",this.initData)},destroyed(){h.Z.$off("refreshGroupInfo",this.initData)},methods:{creatQrCode(){this.showCode=!0,this.qrcode||(new(u())(this.$refs.groupUrl,{text:JSON.stringify({id:this.id,type:2}),width:240,height:240,colorDark:"#000000",colorLight:"#ffffff"}),this.qrcode=!0)},initData(){const t=this.chat.getChatListItem(this.id,this.chat_type);if(!t)return this.backToast();this.setting.is_top=t.is_top,this.setting.show_name=t.show_name,this.setting.no_remind=t.no_remind,this.setting.is_remind=t.is_remind,this.isGroup?(0,d.Ge)(this.id).then((t=>{this.list=t.users.slice(0,4),this.detail=t.info,this.nickname=t.nickname})):this.detail={id:t.id,name:t.name,avatar:t.avatar}},updateChatItem(t,e){this.chat.updateChatItemKey(this.id,this.chat_type,e,t)},addUser(){this.$router.push({path:"/contact_list",query:{id:this.id,type:this.isUser?"createGroup":"inviteGroup"}})},openReport(){this.$router.push({path:"/user_report",query:{user_id:this.id,type:this.chat_type}})},quit(){r.Z.confirm({message:"是否要删除或退出该群聊？"}).then((()=>{(0,d.gF)({id:this.id}).then((()=>{a.Z.success("退出成功"),this.$router.replace({path:"/home"})}))}))},clear(){r.Z.confirm({message:"是否要清空聊天记录？"}).then((()=>{this.chat.clearChatDetail(this.id,this.chat_type),a.Z.success("清空成功"),h.Z.$emit("updateHistory")}))},openHistory(){this.$router.push({path:"/chat_history",query:{chat_type:this.chat_type,id:this.id}})},deleteUser(){this.$router.push({path:"group_user",query:{id:this.id}})},onSubmit(){"nickname"==this.editType?(0,d._u)({id:this.id,nickname:this.nickname}).then((()=>{a.Z.success("修改成功")})):"remark"==this.editType?(0,d.F8)({id:this.id,remark:this.detail.remark}).then((()=>{a.Z.success("修改成功")})):(0,d.F8)({id:this.id,name:this.detail.name}).then((()=>{a.Z.success("修改成功")})),this.editType="",this.show=!1}}},f=m,v=i(1001),_=(0,v.Z)(f,n,s,!1,null,null,null),k=_.exports},79591:function(t,e,i){i.d(e,{Aj:function(){return h},F8:function(){return c},Ge:function(){return o},Q_:function(){return a},X8:function(){return r},_u:function(){return l},bq:function(){return s},gF:function(){return u},od:function(){return d}});var n=i(7705);function s(t){return n.Z.post(n.Z.Group.Create,t)}function a(t){return n.Z.post(n.Z.Group.Invite,t)}function r(t){return n.Z.get(n.Z.Group.List,{p:t})}function o(t){return n.Z.get(n.Z.Group.Info,{id:t})}function c(t){return n.Z.post(n.Z.Group.Edit,t)}function l(t){return n.Z.post(n.Z.Group.Nickname,t)}function u(t){return n.Z.get(n.Z.Group.Quit,t)}function d(t){return n.Z.post(n.Z.Group.KickOff,t)}function h(t){return n.Z.get(n.Z.Group.User,{id:t})}},71568:function(t,e,i){i(58479);var n=i(39146),s=i(76927);e["Z"]={created(){let t=(0,s.cF)("token");if(!t)return this.$router.push({path:"/login"})},methods:{onClickLeft(){this.$router.back()},push(t,e){this.$router.push({path:t,params:e})},draw(){(0,n.Z)("待开发")},backToast(t="非法参数"){this.toast(t),setTimeout((()=>{this.$router.back()}),500)},toast(t="非法参数"){(0,n.Z)({title:t,position:"bottom"})}}}}}]);